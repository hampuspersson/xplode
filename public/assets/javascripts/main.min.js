"use strict";var xplodeApp=angular.module("xplodeApp",["ngRoute","localStorage"]).run(function($rootScope){$rootScope.ROUTES="",$rootScope.ROUTES="/xplode/public"});xplodeApp.config(function($routeProvider){$routeProvider.when("/",{controller:"DashboardController",templateUrl:"partials/dashboard.html"}).when("/program/:programId",{controller:"ProgramController",templateUrl:"partials/program.html"}).when("/program/:programId/day/:day",{controller:"ProgramController",templateUrl:"partials/day.html"}).when("/drill/:drillId",{controller:"DrillController",templateUrl:"partials/drill.html"}).when("/drill/:drillId/add",{controller:"DrillController",templateUrl:"partials/add-drill.html"})}),xplodeApp.directive("fastClick",function($parse){function is_touch_device(){return"ontouchstart"in window||window.navigator.msMaxTouchPoints}return{restrict:"A",link:function(scope,element,attrs){var startX,startY,canceled,fn=$parse(attrs.fastClick),clickFunction=function(event){canceled||scope.$apply(function(){fn(scope,{$event:event})})};is_touch_device()&&(element.on("touchstart",function(event){event.stopPropagation();var touches=event.originalEvent.touches;startX=touches[0].clientX,startY=touches[0].clientY,canceled=!1}),element.on("touchend",function(event){event.stopPropagation(),clickFunction()}),element.on("touchmove",function(event){var touches=event.originalEvent.touches;(Math.abs(touches[0].clientX-startX)>10||Math.abs(touches[0].clientY-startY)>10)&&(canceled=!0)})),is_touch_device()||element.on("click",function(event){clickFunction(event)})}}}),xplodeApp.factory("$api",function($http){function apiPrefix(dir,params){var prefix="api/";return dir=dir||"",params=params?"/"+params:"",prefix+dir+params}return{getAllUsers:function(){return $http.get(apiPrefix("users")).then(function(result){return result.data})},getCurrentUser:function(id){return $http.get(apiPrefix("users",id)).then(function(result){return result.data})},getLoggedInUser:function(){return $http.get(apiPrefix("users","?getLoggedInUser")).then(function(result){return result.data})},getAllPrograms:function(){return $http.get(apiPrefix("programs")).then(function(result){return result.data})},getProgram:function(programId){return $http.get(apiPrefix("programs",programId)).then(function(result){return result.data})},getUserPrograms:function(userId){return $http.get(apiPrefix("programs","?user="+userId)).then(function(result){return result.data})},getAllDrills:function(){return $http.get(apiPrefix("drills")).then(function(result){return result.data})},getDrill:function(drillId){return $http.get(apiPrefix("drills",drillId)).then(function(result){return result.data})},getDrillsInProgram:function(programId){return $http.get(apiPrefix("drills","?program="+programId)).then(function(result){return result.data})},getResults:function(drillId,userId){return $http.get(apiPrefix("results","?drill="+drillId+"&user="+userId)).then(function(result){return result.data})},addResult:function(data){return $http.post(apiPrefix("results"),data).then(function(result){return result.data})}}}),xplodeApp.factory("$program",function(){return{current:{}}}),xplodeApp.factory("$utilities",function(){function addZero(n){return 10>n?"0"+n:""+n}return{getTime:function(timestamp){timestamp=timestamp||(new Date).getTime();var date=new Date(timestamp),obj={year:date.getFullYear(),month:addZero(date.getMonth()+1),day:addZero(date.getDate()),hours:addZero(date.getHours()),minutes:addZero(date.getMinutes()),seconds:addZero(date.getSeconds())};return obj.year+"-"+obj.month+"-"+obj.day+" "+obj.hours+":"+obj.minutes+":"+obj.seconds}}}),xplodeApp.controller("DashboardController",function($scope,$api,$store){function init(){$store.remove("user"),$store.remove("program"),$api.getLoggedInUser().then(function(result){$scope.currentUserId=result,$scope.user=$api.getCurrentUser($scope.currentUserId).then(function(result){return result.max=jQuery.parseJSON(result.max),result.firstName=result.name.substring(0,result.name.indexOf(" ")),$store.set("user",result),$scope.programs=$api.getUserPrograms($scope.currentUserId).then(function(result){var user=$store.get("user");return user.programs=result.programs,$store.set("user",user),result.programs}),result})})}init()}),xplodeApp.controller("ProgramController",function($scope,$routeParams,$api,$store){function init(){$routeParams.day&&($scope.day=$routeParams.day,$store.set("day",$routeParams.day)),$store.get("user")?$scope.user=$store.get("user"):$scope.currentUserId=$api.getLoggedInUser().then(function(){$scope.user=$api.getCurrentUser($scope.currentUserId).then(function(result){return result.max=jQuery.parseJSON(result.max),result.firstName=result.name.substring(0,result.name.indexOf(" ")),$store.set("user",result),result})}),$scope.program=$store.get("program")?$store.get("program"):$api.getProgram($routeParams.programId).then(function(result){return result.days=JSON.parse(result.days),$store.set("program",result),result})}init()}),xplodeApp.controller("DrillController",function($scope,$routeParams,$api,$store,$utilities){function init(){$scope.user=$store.get("user"),$scope.program=$store.get("program"),$scope.day=$store.get("day"),$scope.drillReps=10,$scope.drillWeight=80,$scope.drillId=$routeParams.drillId,$scope.drill=$api.getDrill($routeParams.drillId).then(function(result){return result}),$scope.reps=$api.getResults($scope.drillId,$scope.user.id).then(function(result){for(var i=0;i<result.length;i++){var month=0===result[i].created_at.substring(5,6)?result[i].created_at.substring(6,7):result[i].created_at.substring(5,7),day=0===result[i].created_at.substring(8,9)?result[i].created_at.substring(9,10):result[i].created_at.substring(8,10),time=result[i].created_at.substring(11,16);result[i].displayDate=day+"/"+month+" "+time}return result})}init(),$scope.addSet=function(){var btn=document.getElementById("submit-result");btn.classList.add("sending"),btn.value="Jobbar...",$api.addResult({user_id:$scope.user.id,drill_id:$scope.drillId,program_id:$scope.program.id,reps:$scope.drillReps,weight:$scope.drillWeight}).then(function(){btn.classList.remove("sending"),btn.classList.add("success"),btn.value="Grymt jobbat!",setTimeout(function(){btn.classList.remove("success"),btn.value="Registrera",btn.blur()},2e3)}),$scope.reps.$$v.unshift({created_at:$utilities.getTime(),user_id:$scope.user.id,drill_id:$scope.drillId,reps:$scope.drillReps,weight:$scope.drillWeight,displayDate:"idag"})}});
/*
//@ sourceMappingURL=map/source-map-main.js
*/